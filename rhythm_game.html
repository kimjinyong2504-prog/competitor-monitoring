<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î¶¨Îì¨Í≤åÏûÑ - DJÎß•Ïä§ Ïä§ÌÉÄÏùº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            gap: 20px;
            padding: 20px;
        }

        .game-container {
            width: 900px;
            height: 700px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .game-header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .game-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            color: white;
            font-size: 18px;
            margin-bottom: 20px;
        }

        .score-item {
            text-align: center;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }

        .game-area {
            position: relative;
            width: 100%;
            height: 500px;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.7));
            border-radius: 10px;
            overflow: hidden;
        }

        .lane {
            position: absolute;
            width: calc((100% - 10px) / 6);
            height: 100%;
            border-left: 2px solid rgba(255, 255, 255, 0.2);
            border-right: 2px solid rgba(255, 255, 255, 0.2);
        }

        .lane:nth-child(1) { left: 0; }
        .lane:nth-child(2) { left: calc((100% - 10px) / 6); }
        .lane:nth-child(3) { left: calc((100% - 10px) / 6 * 2); }
        .lane:nth-child(4) { left: calc((100% - 10px) / 6 * 3); }
        .lane:nth-child(5) { left: calc((100% - 10px) / 6 * 4); }
        .lane:nth-child(6) { left: calc((100% - 10px) / 6 * 5); }

        .judge-line {
            position: absolute;
            bottom: 80px;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, 
                #ff0000, #ff6600, #ffcc00, #66ff00, #00ccff, #6600ff);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            z-index: 10;
        }

        .note {
            position: absolute;
            width: calc((100% - 20px) / 6);
            height: 30px;
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.8);
            transition: transform 0.1s;
            z-index: 5;
        }

        .note.lane-0 { left: 5px; }
        .note.lane-1 { left: calc((100% - 20px) / 6 + 5px); }
        .note.lane-2 { left: calc((100% - 20px) / 6 * 2 + 5px); }
        .note.lane-3 { left: calc((100% - 20px) / 6 * 3 + 5px); }
        .note.lane-4 { left: calc((100% - 20px) / 6 * 4 + 5px); }
        .note.lane-5 { left: calc((100% - 20px) / 6 * 5 + 5px); }

        .note.hit {
            animation: hitEffect 0.3s ease-out;
        }

        @keyframes hitEffect {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
            100% { transform: scale(2); opacity: 0; }
        }

        .key-indicator {
            position: absolute;
            bottom: 20px;
            width: calc((100% - 20px) / 6);
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            transition: all 0.1s;
        }

        .key-indicator.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            transform: scale(1.1);
        }

        .key-indicator.lane-0 { left: 5px; }
        .key-indicator.lane-1 { left: calc((100% - 20px) / 6 + 5px); }
        .key-indicator.lane-2 { left: calc((100% - 20px) / 6 * 2 + 5px); }
        .key-indicator.lane-3 { left: calc((100% - 20px) / 6 * 3 + 5px); }
        .key-indicator.lane-4 { left: calc((100% - 20px) / 6 * 4 + 5px); }
        .key-indicator.lane-5 { left: calc((100% - 20px) / 6 * 5 + 5px); }

        .judge-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px currentColor;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 20;
        }

        .judge-text.show {
            opacity: 1;
        }

        .judge-text.perfect {
            color: #ffd700;
            text-shadow: 0 0 30px #ffd700;
        }

        .judge-text.great {
            color: #00ff00;
            text-shadow: 0 0 30px #00ff00;
        }

        .judge-text.good {
            color: #00ccff;
            text-shadow: 0 0 30px #00ccff;
        }

        .judge-text.miss {
            color: #ff0000;
            text-shadow: 0 0 30px #ff0000;
        }

        .game-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .combo-display {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .combo-count {
            color: #ffd700;
            font-size: 36px;
            text-shadow: 0 0 10px #ffd700;
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
            border-radius: 20px;
        }

        .game-over.show {
            display: flex;
        }

        .game-over h2 {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .game-over .final-score {
            font-size: 32px;
            color: #ffd700;
            margin-bottom: 30px;
        }

        .settings-panel {
            background: rgba(0, 0, 0, 0.85);
            padding: 20px;
            border-radius: 15px;
            color: white;
            width: 250px;
            max-height: 700px;
            border: 2px solid rgba(255, 215, 0, 0.4);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .settings-panel.collapsed {
            width: 80px;
            padding: 20px 10px;
        }

        .settings-panel.collapsed .settings-content {
            display: none;
        }

        .settings-toggle {
            width: 100%;
            height: 40px;
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .settings-toggle:hover {
            background: rgba(255, 215, 0, 0.3);
            border-color: #ffd700;
            transform: scale(1.05);
        }

        .settings-panel.collapsed .settings-toggle {
            margin-bottom: 0;
        }

        .settings-content {
            flex: 1;
            transition: opacity 0.3s ease;
        }

        .settings-panel h3 {
            margin-bottom: 15px;
            font-size: 18px;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .setting-item .value {
            display: inline-block;
            margin-left: 10px;
            color: #ffd700;
            font-weight: bold;
            min-width: 50px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        .difficulty-buttons {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .difficulty-btn {
            flex: 1;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
    </style>
</head>
<body>
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-toggle" id="settingsToggle">‚öôÔ∏è ÏÑ§Ï†ï</div>
        <div class="settings-content">
            <h3>‚öôÔ∏è Í≤åÏûÑ ÏÑ§Ï†ï</h3>
            <div class="setting-item">
                <label>
                    ÏÜçÎèÑ: <span class="value" id="speedValue">3</span>
                </label>
                <input type="range" class="slider" id="speedSlider" min="1" max="10" value="3" step="0.5">
            </div>
            <div class="setting-item">
                <label>ÎÇúÏù¥ÎèÑ</label>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn active" data-difficulty="easy">Ïâ¨ÏõÄ</button>
                    <button class="difficulty-btn" data-difficulty="normal">Î≥¥ÌÜµ</button>
                    <button class="difficulty-btn" data-difficulty="hard">Ïñ¥Î†§ÏõÄ</button>
                    <button class="difficulty-btn" data-difficulty="expert">Ï†ÑÎ¨∏Í∞Ä</button>
                </div>
            </div>
        </div>
    </div>

    <div class="game-container">
        <div class="game-header">
            <h1>üéµ Î¶¨Îì¨Í≤åÏûÑ üéµ</h1>
        </div>

        <div class="score-board">
            <div class="score-item">
                <div>Ï†êÏàò</div>
                <div class="score-value" id="score">0</div>
            </div>
            <div class="score-item">
                <div>Perfect</div>
                <div class="score-value" id="perfect">0</div>
            </div>
            <div class="score-item">
                <div>Great</div>
                <div class="score-value" id="great">0</div>
            </div>
            <div class="score-item">
                <div>Good</div>
                <div class="score-value" id="good">0</div>
            </div>
            <div class="score-item">
                <div>Miss</div>
                <div class="score-value" id="miss">0</div>
            </div>
        </div>

        <div class="combo-display">
            <div>COMBO</div>
            <div class="combo-count" id="combo">0</div>
        </div>

        <div class="game-area" id="gameArea">
            <div class="lane"></div>
            <div class="lane"></div>
            <div class="lane"></div>
            <div class="lane"></div>
            <div class="lane"></div>
            <div class="lane"></div>
            <div class="judge-line"></div>
            <div class="judge-text" id="judgeText"></div>
            
            <div class="key-indicator lane-0" id="key0">Q</div>
            <div class="key-indicator lane-1" id="key1">W</div>
            <div class="key-indicator lane-2" id="key2">E</div>
            <div class="key-indicator lane-3" id="key3">I</div>
            <div class="key-indicator lane-4" id="key4">O</div>
            <div class="key-indicator lane-5" id="key5">P</div>
        </div>

        <div class="game-controls">
            <button class="btn" id="startBtn">ÏãúÏûë</button>
            <button class="btn" id="pauseBtn">ÏùºÏãúÏ†ïÏßÄ</button>
            <button class="btn" id="resetBtn">Î¶¨ÏÖã</button>
        </div>

        <div class="game-over" id="gameOver">
            <h2>Í≤åÏûÑ Ï¢ÖÎ£å!</h2>
            <div class="final-score">ÏµúÏ¢Ö Ï†êÏàò: <span id="finalScore">0</span></div>
            <button class="btn" onclick="resetGame()">Îã§Ïãú ÏãúÏûë</button>
        </div>
    </div>

    <script>
        // Í≤åÏûÑ Î≥ÄÏàò
        const gameArea = document.getElementById('gameArea');
        const judgeLine = document.querySelector('.judge-line');
        const judgeText = document.getElementById('judgeText');
        const keys = ['q', 'w', 'e', 'i', 'o', 'p'];
        const keyIndicators = document.querySelectorAll('.key-indicator');
        
        let gameState = {
            isPlaying: false,
            isPaused: false,
            score: 0,
            combo: 0,
            perfect: 0,
            great: 0,
            good: 0,
            miss: 0,
            notes: [],
            noteId: 0,
            speed: 3,
            lastNoteTime: 0,
            difficulty: 'normal'
        };

        // ÎÇúÏù¥ÎèÑ ÏÑ§Ï†ï
        const difficultySettings = {
            easy: {
                noteInterval: 800,      // ÎÖ∏Ìä∏ ÏÉùÏÑ± Í∞ÑÍ≤© (Î∞ÄÎ¶¨Ï¥à)
                noteSpawnChance: 0.4,   // ÎÖ∏Ìä∏ ÏÉùÏÑ± ÌôïÎ•†
                perfectRange: 20,       // Perfect ÌåêÏ†ï Î≤îÏúÑ
                greatRange: 40,          // Great ÌåêÏ†ï Î≤îÏúÑ
                goodRange: 60            // Good ÌåêÏ†ï Î≤îÏúÑ
            },
            normal: {
                noteInterval: 600,
                noteSpawnChance: 0.5,
                perfectRange: 15,
                greatRange: 30,
                goodRange: 50
            },
            hard: {
                noteInterval: 400,
                noteSpawnChance: 0.6,
                perfectRange: 10,
                greatRange: 20,
                goodRange: 35
            },
            expert: {
                noteInterval: 300,
                noteSpawnChance: 0.7,
                perfectRange: 8,
                greatRange: 15,
                goodRange: 25
            }
        };

        // ÌåêÏ†ïÏÑ† ÏúÑÏπò Í≥ÑÏÇ∞ Ìï®Ïàò (ÌÇ§ Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ Î∞îÎ°ú ÏúÑ)
        function getJudgeLineY() {
            // CSSÏóêÏÑú bottom: 80pxÎ°ú ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏúºÎØÄÎ°ú
            // ÎÖ∏Ìä∏ÎèÑ bottom ÏÜçÏÑ±ÏùÑ ÏÇ¨Ïö©ÌïòÎØÄÎ°ú ÏßÅÏ†ë 80ÏùÑ Î∞òÌôò
            return 80;
        }
        
        const noteHeight = 30;
        
        // ÌòÑÏû¨ ÎÇúÏù¥ÎèÑÏóê Îî∞Î•∏ ÌåêÏ†ï Î≤îÏúÑ Í∞ÄÏ†∏Ïò§Í∏∞
        function getJudgeRanges() {
            const settings = difficultySettings[gameState.difficulty];
            return {
                perfect: settings.perfectRange,
                great: settings.greatRange,
                good: settings.goodRange
            };
        }

        // ÎÖ∏Ìä∏ ÏÉùÏÑ±
        function createNote(lane) {
            const note = document.createElement('div');
            note.className = `note lane-${lane}`;
            note.id = `note-${gameState.noteId++}`;
            // ÎÖ∏Ìä∏Î•º Í≤åÏûÑ ÏòÅÏó≠ Îß® ÏúÑÏóêÏÑú ÏãúÏûë
            // bottom ÏúÑÏπòÍ∞Ä Í≤åÏûÑ ÏòÅÏó≠ ÎÜíÏù¥Î©¥ ÎÖ∏Ìä∏Ïùò ÌïòÎã®Ïù¥ Îß® ÏïÑÎûòÏóê ÏûàÏùå
            // ÎÖ∏Ìä∏Í∞Ä ÏúÑÏóêÏÑú ÏïÑÎûòÎ°ú ÎÇ¥Î†§Ïò§Î†§Î©¥, ÎÖ∏Ìä∏Ïùò ÌïòÎã®Ïù¥ Í≤åÏûÑ ÏòÅÏó≠ Îß® ÏúÑÏóê ÏûàÏñ¥Ïïº Ìï®
            // Í≤åÏûÑ ÏòÅÏó≠ ÎÜíÏù¥ÏóêÏÑú ÎÖ∏Ìä∏ ÎÜíÏù¥Î•º ÎπºÎ©¥ ÎÖ∏Ìä∏Ïùò ÌïòÎã®Ïù¥ Îß® ÏúÑÏóê ÏúÑÏπò
            const gameAreaHeight = gameArea.offsetHeight;
            const startY = gameAreaHeight; // ÎÖ∏Ìä∏Ïùò ÌïòÎã®Ïù¥ Í≤åÏûÑ ÏòÅÏó≠ Îß® ÏúÑÏóê ÏúÑÏπò
            note.style.bottom = `${startY}px`;
            note.dataset.lane = lane;
            note.dataset.id = note.id;
            gameArea.appendChild(note);
            
            gameState.notes.push({
                element: note,
                lane: lane,
                y: startY,
                id: note.id
            });

            return note;
        }

        // ÎûúÎç§ ÎÖ∏Ìä∏ ÏÉùÏÑ±
        function generateRandomNote() {
            const lane = Math.floor(Math.random() * 6);
            createNote(lane);
        }

        // ÎÖ∏Ìä∏ Ïù¥Îèô
        function updateNotes() {
            if (!gameState.isPlaying || gameState.isPaused) return;

            const judgeLineY = getJudgeLineY();
            const gameAreaHeight = gameArea.offsetHeight;
            
            // Ïó≠ÏàúÏúºÎ°ú ÏàúÌöåÌïòÏó¨ Î∞∞Ïó¥ ÏàòÏ†ï Ïãú Ïù∏Îç±Ïä§ Î¨∏Ï†ú Î∞©ÏßÄ
            for (let i = gameState.notes.length - 1; i >= 0; i--) {
                const note = gameState.notes[i];
                note.y -= gameState.speed;
                note.element.style.bottom = `${note.y}px`;

                // ÎÖ∏Ìä∏Í∞Ä ÌåêÏ†ïÏÑ†ÏùÑ ÎÑàÎ¨¥ ÏßÄÎÇòÏ≥§Í±∞ÎÇò ÌôîÎ©¥ Î∞ñÏúºÎ°ú ÎÇòÍ∞îÏùÑ Îïå Ï†úÍ±∞
                if (note.y < -noteHeight || note.y > gameAreaHeight + 100) {
                    note.element.remove();
                    gameState.notes.splice(i, 1);
                }
            }
        }

        // ÌåêÏ†ï Ï≤òÎ¶¨ - ÎÖ∏Ìä∏Í∞Ä Î¨¥ÏßÄÍ∞ú ÏÑ†Ïóê ÎãøÏïòÏùÑ Îïå ÌåêÏ†ï
        function judgeNote(lane) {
            const judgeLineY = getJudgeLineY();
            const ranges = getJudgeRanges();
            let closestNote = null;
            let minDistance = Infinity;

            // Ìï¥Îãπ Î†àÏù∏Ïùò Î™®Îì† ÎÖ∏Ìä∏Î•º ÌôïÏù∏
            for (let i = 0; i < gameState.notes.length; i++) {
                const note = gameState.notes[i];
                if (note.lane === lane) {
                    // note.yÎäî bottom ÏúÑÏπò (Í≤åÏûÑ ÏòÅÏó≠ ÌïòÎã®ÏóêÏÑúÏùò Í±∞Î¶¨)
                    // ÎÖ∏Ìä∏Ïùò ÌïòÎã®Ïù¥ ÌåêÏ†ïÏÑ†Ïóê ÎãøÏïòÏùÑ Îïå: note.y ‚âà judgeLineY
                    const noteBottom = note.y;
                    const distance = Math.abs(judgeLineY - noteBottom);
                    
                    // ÎÖ∏Ìä∏Í∞Ä ÌåêÏ†ïÏÑ†Ïóê ÎãøÏïòÎäîÏßÄ ÌôïÏù∏
                    if (distance <= ranges.good) {
                        // Í∞ÄÏû• Í∞ÄÍπåÏö¥ ÎÖ∏Ìä∏ ÏÑ†ÌÉù
                        if (distance < minDistance) {
                            minDistance = distance;
                            closestNote = { note, index: i, distance };
                        }
                    }
                }
            }

            // ÌåêÏ†ï Ï≤òÎ¶¨
            if (closestNote && minDistance <= ranges.good) {
                const { note, index, distance } = closestNote;
                let judge = '';

                // Í±∞Î¶¨Ïóê Îî∞Îùº ÌåêÏ†ï (ÎÖ∏Ìä∏Í∞Ä ÌåêÏ†ïÏÑ†Ïóê Í∞ÄÍπåÏö∏ÏàòÎ°ù ÎÜíÏùÄ ÌåêÏ†ï)
                if (distance <= ranges.perfect) {
                    judge = 'PERFECT';
                    gameState.perfect++;
                    gameState.score += 1000;
                    gameState.combo++;
                } else if (distance <= ranges.great) {
                    judge = 'GREAT';
                    gameState.great++;
                    gameState.score += 500;
                    gameState.combo++;
                } else if (distance <= ranges.good) {
                    judge = 'GOOD';
                    gameState.good++;
                    gameState.score += 200;
                    gameState.combo++;
                }

                // ÌåêÏ†ï ÌëúÏãú Î∞è ÎÖ∏Ìä∏ Ï†úÍ±∞
                if (judge) {
                    note.element.classList.add('hit');
                    showJudgeText(judge, judge.toLowerCase());
                    // ÌåêÏ†ïÎêú ÎÖ∏Ìä∏ Ï†úÍ±∞
                    note.element.remove();
                    gameState.notes.splice(index, 1);
                    updateScore();
                    return; // ÌåêÏ†ï ÏÑ±Í≥µ Ïãú Ï¢ÖÎ£å
                }
            }
            
            // ÌåêÏ†ï Ïã§Ìå® (ÎÖ∏Ìä∏Í∞Ä ÏóÜÍ±∞ÎÇò Î≤îÏúÑ Î∞ñ)
            gameState.miss++;
            gameState.combo = 0;
            showJudgeText('MISS', 'miss');
            updateScore();
        }

        // ÌåêÏ†ï ÌÖçÏä§Ìä∏ ÌëúÏãú
        function showJudgeText(text, type) {
            judgeText.textContent = text;
            judgeText.className = `judge-text ${type} show`;
            setTimeout(() => {
                judgeText.classList.remove('show');
            }, 500);
        }

        // Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏
        function updateScore() {
            document.getElementById('score').textContent = gameState.score.toLocaleString();
            document.getElementById('perfect').textContent = gameState.perfect;
            document.getElementById('great').textContent = gameState.great;
            document.getElementById('good').textContent = gameState.good;
            document.getElementById('miss').textContent = gameState.miss;
            document.getElementById('combo').textContent = gameState.combo;
        }

        // ÌÇ§ ÏûÖÎ†• Ï≤òÎ¶¨
        document.addEventListener('keydown', (e) => {
            if (!gameState.isPlaying || gameState.isPaused) return;

            const key = e.key.toLowerCase();
            const laneIndex = keys.indexOf(key);

            if (laneIndex !== -1) {
                keyIndicators[laneIndex].classList.add('active');
                judgeNote(laneIndex);
            }
        });

        document.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            const laneIndex = keys.indexOf(key);

            if (laneIndex !== -1) {
                keyIndicators[laneIndex].classList.remove('active');
            }
        });

        // Í≤åÏûÑ ÏãúÏûë
        function startGame() {
            if (gameState.isPlaying) return;
            
            gameState.isPlaying = true;
            gameState.isPaused = false;
            gameState.lastNoteTime = Date.now();

            const difficulty = difficultySettings[gameState.difficulty];

            // ÎÖ∏Ìä∏ ÏÉùÏÑ± Ïù∏ÌÑ∞Î≤å (ÎÇúÏù¥ÎèÑÏóê Îî∞Îùº Ï°∞Ï†à)
            const noteInterval = setInterval(() => {
                if (!gameState.isPlaying || gameState.isPaused) {
                    clearInterval(noteInterval);
                    return;
                }
                
                // ÎÇúÏù¥ÎèÑÏóê Îî∞Î•∏ ÎÖ∏Ìä∏ ÏÉùÏÑ± ÌôïÎ•†
                if (Math.random() < difficulty.noteSpawnChance) {
                    generateRandomNote();
                }
            }, difficulty.noteInterval);

            // Í≤åÏûÑ Î£®ÌîÑ
            const gameLoop = setInterval(() => {
                if (!gameState.isPlaying) {
                    clearInterval(gameLoop);
                    return;
                }
                updateNotes();
            }, 16); // 60fps

            // 30Ï¥à ÌõÑ Í≤åÏûÑ Ï¢ÖÎ£å
            setTimeout(() => {
                endGame();
            }, 30000);
        }

        // Í≤åÏûÑ ÏùºÏãúÏ†ïÏßÄ
        function pauseGame() {
            if (!gameState.isPlaying) return;
            gameState.isPaused = !gameState.isPaused;
        }

        // Í≤åÏûÑ Ï¢ÖÎ£å
        function endGame() {
            gameState.isPlaying = false;
            document.getElementById('finalScore').textContent = gameState.score.toLocaleString();
            document.getElementById('gameOver').classList.add('show');
        }

        // Í≤åÏûÑ Î¶¨ÏÖã
        function resetGame() {
            gameState.isPlaying = false;
            gameState.isPaused = false;
            gameState.score = 0;
            gameState.combo = 0;
            gameState.perfect = 0;
            gameState.great = 0;
            gameState.good = 0;
            gameState.miss = 0;
            gameState.notes = [];
            gameState.noteId = 0;

            // Î™®Îì† ÎÖ∏Ìä∏ Ï†úÍ±∞
            document.querySelectorAll('.note').forEach(note => note.remove());
            
            document.getElementById('gameOver').classList.remove('show');
            updateScore();
        }

        // ÏÑ§Ï†ï Ìå®ÎÑê Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞
        const settingsPanel = document.getElementById('settingsPanel');
        const settingsToggle = document.getElementById('settingsToggle');
        
        settingsToggle.addEventListener('click', () => {
            settingsPanel.classList.toggle('collapsed');
        });

        // ÏÜçÎèÑ Ï°∞Ï†à Ïä¨ÎùºÏù¥Îçî
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        
        speedSlider.addEventListener('input', (e) => {
            gameState.speed = parseFloat(e.target.value);
            speedValue.textContent = gameState.speed.toFixed(1);
        });

        // ÎÇúÏù¥ÎèÑ Î≤ÑÌäº
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        difficultyButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const difficulty = e.target.dataset.difficulty;
                gameState.difficulty = difficulty;
                
                // ÌôúÏÑ±Ìôî ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                difficultyButtons.forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
            });
        });

        // Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('pauseBtn').addEventListener('click', pauseGame);
        document.getElementById('resetBtn').addEventListener('click', resetGame);

        // Ï¥àÍ∏∞Ìôî
        updateScore();
    </script>
</body>
</html>
